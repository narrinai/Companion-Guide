<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Companion Tracking Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        h1 {
            color: #fff;
            margin-bottom: 10px;
        }
        .info {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .test-links {
            display: grid;
            gap: 20px;
            margin: 30px 0;
        }
        .test-card {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
        }
        .test-card h3 {
            margin-top: 0;
            color: #fff;
        }
        .btn-secondary {
            display: inline-block;
            padding: 12px 24px;
            background: #6366f1;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-secondary:hover {
            background: #4f46e5;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .event-log {
            margin-top: 10px;
            padding: 5px;
            background: #1a1a1a;
            border-left: 3px solid #0f0;
        }
        .success {
            color: #4ade80;
        }
        .warning {
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <h1>üéØ Meta Companion Tracking Test Page</h1>
    <p style="color: #888;">Test the custom Meta Pixel event tracking for companion external links</p>

    <div class="info">
        <h3>üìä What This Tests:</h3>
        <ul>
            <li><strong>Custom Event Name:</strong> CompanionExternalClick</li>
            <li><strong>Event Data:</strong> companion_name, companion_url, page_location, button_type, companion_slug</li>
            <li><strong>Trigger:</strong> Click on any "Visit Website" button below</li>
        </ul>
    </div>

    <div class="info">
        <h3>‚úÖ How to Verify:</h3>
        <ol>
            <li>Open browser DevTools Console (F12)</li>
            <li>Click any "Visit Website" button below</li>
            <li>Check the console output for "Meta Pixel: CompanionExternalClick tracked"</li>
            <li>Verify the event in Meta Events Manager (facebook.com/events_manager2)</li>
        </ol>
    </div>

    <div class="test-links">
        <div class="test-card companion-card">
            <h3>Secrets AI</h3>
            <p>Test tracking for Secrets AI companion</p>
            <a href="https://www.secrets.ai/browse?fpr=companionguide" class="btn-secondary" target="_blank">Visit Website</a>
        </div>

        <div class="test-card companion-card">
            <h3>Candy AI</h3>
            <p>Test tracking for Candy AI companion</p>
            <a href="https://t.mbsrv2.com/388589/7793?popUnder=true&source=companionguide" class="btn-secondary" target="_blank">Visit Website</a>
        </div>

        <div class="test-card companion-card">
            <h3>Narrin.AI</h3>
            <p>Test tracking for Narrin.AI companion</p>
            <a href="https://narrin.ai" class="btn-secondary" target="_blank">Visit Website</a>
        </div>
    </div>

    <div class="info">
        <h3>üìù Console Output:</h3>
        <div class="console-output" id="console-output">
            <div class="success">‚úì Waiting for tracking events...</div>
        </div>
    </div>

    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1384707780100464');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1384707780100464&ev=PageView&noscript=1"
    alt=""/></noscript>
    <!-- End Meta Pixel Code -->

    <!-- Meta Companion Tracking Script -->
    <script src="/js/meta-companion-tracking.js"></script>

    <!-- Console Output Display -->
    <script>
        const consoleOutput = document.getElementById('console-output');

        // Override console.log to display in page
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);

            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    return JSON.stringify(arg, null, 2);
                }
                return arg;
            }).join(' ');

            const logEntry = document.createElement('div');
            logEntry.className = 'event-log';
            logEntry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // Override fbq to show when events are tracked
        const originalFbq = window.fbq;
        window.fbq = function(...args) {
            if (args[0] === 'trackCustom' && args[1] === 'CompanionExternalClick') {
                const eventData = args[2];
                console.log('‚úì Meta Pixel Event Fired:', {
                    eventName: args[1],
                    ...eventData
                });
            }
            return originalFbq.apply(this, args);
        };

        console.log('‚úì Test page loaded');
        console.log('‚úì Meta Pixel initialized');
        console.log('‚úì Companion tracking script loaded');
        console.log('‚Üí Click any "Visit Website" button to test tracking');
    </script>
</body>
</html>
